# Правила разработки кода

## Общие принципы

- **KISS:** Максимум простоты, минимум абстракций
- **YAGNI:** Реализуй только необходимое для MVP
- **Читаемость:** Код должен быть понятен через месяц

## Структура кода

- Вся логика в одном файле `src/bot.py`
- Один класс - вся функциональность бота
- Минимум методов, только необходимое
- Нет разделения на модули, слои, сервисы

## Код-стиль

- **Импорты:** Стандартная библиотека → внешние зависимости
- **Именование:** Понятные имена на русском в строках (для пользователя), коде - английском
- **Длина:** Функция > 50 строк - пересмотреть логику
- **Константы:** Все магические значения выносим в константы

## Архитектурные ограничения

- **Без БД:** Все в памяти (in-memory)
- **Без кеша:** Прямые запросы к API
- **Без очередей:** Синхронная обработка
- **Без фоновых задач:** Простой request-response

## Обработка ошибок

- Все ошибки логируй
- Пользователю - понятное сообщение
- Бот не падает, продолжает работу
- Try-except для всех внешних вызовов

## Конфигурация

- Все секреты в `.env`
- Нет хардкода API ключей
- Системный промпт - константа в коде
- Проверка наличия обязательных переменных при старте

## Логирование

- Стандартный `logging` модуль
- INFO для важных событий
- ERROR для ошибок
- Не логируй сообщения пользователей
- Не логируй API ключи

## Telegram-бот специфика

- Aiogram через polling
- Один хэндлер - обработчик всех текстовых сообщений
- История диалога - список сообщений в памяти
- Системный промпт добавляется в начало истории

## LLM интеграция

- OpenAI client с кастомным base_url для OpenRouter
- История передается целиком
- Без параметров (temperature, top_p и т.д.)
- Обработка ошибок API обязательна

## Комментарии

- Только для сложной логики
- Docstrings для класса и публичных методов
- Нет очевидных комментариев

## Тестирование

- Сначала запусти и проверь вручную
- Нет юнит-тестов на этапе MVP
- Проверка базовых сценариев достаточна

