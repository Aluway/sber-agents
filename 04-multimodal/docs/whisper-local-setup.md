# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Whisper (faster-whisper)

**–î–∞—Ç–∞:** 13 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!

---

## üéØ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –±–∞–∑–µ **faster-whisper** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ OpenAI Whisper.

### ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **faster-whisper** - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
2. **Flask API** - REST —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–ú–æ–¥–µ–ª—å whisper-base** - –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
python3 -m venv ~/whisper-env
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
~/whisper-env/bin/pip install faster-whisper flask
```

**–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:**
- `faster-whisper==1.2.1` - —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è
- `flask==3.1.2` - –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
- `ctranslate2==4.6.1` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫
- + –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (~150 MB)

---

## üöÄ Flask API —Å–µ—Ä–≤–∏—Å

### –§–∞–π–ª: `~/whisper-service.py`

```python
from flask import Flask, request, jsonify
from faster_whisper import WhisperModel
import tempfile
import os

app = Flask(__name__)

# –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
print('Loading Whisper model...')
model = WhisperModel('base', device='cpu', compute_type='int8')
print('Model loaded!')

@app.route('/transcribe', methods=['POST'])
def transcribe():
    """–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∞—É–¥–∏–æ —Ñ–∞–π–ª–∞"""
    try:
        if 'file' not in request.files:
            return jsonify({'error': 'No file provided'}), 400
        
        audio_file = request.files['file']
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
        with tempfile.NamedTemporaryFile(delete=False, suffix='.ogg') as tmp:
            audio_file.save(tmp.name)
            tmp_path = tmp.name
        
        try:
            # –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è
            segments, info = model.transcribe(tmp_path, language='ru')
            text = ' '.join([segment.text for segment in segments])
            
            return jsonify({
                'text': text,
                'language': info.language,
                'duration': info.duration
            })
        finally:
            os.unlink(tmp_path)
    
    except Exception as e:
        return jsonify({'error': str(e)}), 500

@app.route('/health', methods=['GET'])
def health():
    """Health check endpoint"""
    return jsonify({'status': 'ok', 'model': 'whisper-base'})

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
```

---

## üîß –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

### –í—Ä—É—á–Ω—É—é (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
~/whisper-env/bin/python ~/whisper-service.py
```

### –í —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ

```bash
nohup ~/whisper-env/bin/python ~/whisper-service.py > ~/whisper.log 2>&1 &
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
tail -f ~/whisper.log
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
Loading Whisper model...
Model loaded!
 * Serving Flask app 'whisper-service'
 * Running on http://195.209.210.250:5000
```

---

## üî• Firewall

### –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞ 5000

```bash
sudo ufw allow 5000/tcp
sudo ufw status | grep 5000
```

**–í—ã–≤–æ–¥:**
```
5000/tcp                   ALLOW       Anywhere
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Health Check

```bash
curl http://195.209.210.250:5000/health
```

**–û—Ç–≤–µ—Ç:**
```json
{"model":"whisper-base","status":"ok"}
```

### –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è (–ø—Ä–∏–º–µ—Ä —Å curl)

```bash
curl -X POST \
  -F "file=@voice.ogg" \
  http://195.209.210.250:5000/transcribe
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "text": "–ö—É–ø–∏–ª –ø—Ä–æ–¥—É–∫—Ç—ã –Ω–∞ –¥–≤–µ —Å –ø–æ–ª–æ–≤–∏–Ω–æ–π —Ç—ã—Å—è—á–∏",
  "language": "ru",
  "duration": 3.5
}
```

---

## ü§ñ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º

### –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å –≤ `.env`:

```bash
WHISPER_LOCAL_URL=http://195.209.210.250:5000
```

### –ö–æ–¥ –±–æ—Ç–∞

```python
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
self.whisper_local_url = os.getenv("WHISPER_LOCAL_URL")
self.use_local_whisper = bool(self.whisper_local_url)

# –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è
if self.use_local_whisper:
    response = requests.post(
        f"{self.whisper_local_url}/transcribe",
        files={"file": ("voice.ogg", voice_bytes.read(), "audio/ogg")}
    )
    result = response.json()
    transcribed_text = result['text']
```

---

## üìä –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

### –ú–æ–¥–µ–ª—å: whisper-base

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏ | 145 MB |
| –¢–æ—á–Ω–æ—Å—Ç—å (—Ä—É—Å—Å–∫–∏–π) | ~80% |
| –°–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ CPU | 15-30 —Å–µ–∫/–º–∏–Ω –∞—É–¥–∏–æ |
| –ü–∞–º—è—Ç—å | ~500 MB RAM |
| –Ø–∑—ã–∫ | –†—É—Å—Å–∫–∏–π (–∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ) |

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ù–∞ CPU (—Ç–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è):**
- –ì–æ–ª–æ—Å–æ–≤–æ–µ 10 —Å–µ–∫ ‚Üí —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è ~3-5 —Å–µ–∫
- –ì–æ–ª–æ—Å–æ–≤–æ–µ 30 —Å–µ–∫ ‚Üí —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è ~10-15 —Å–µ–∫
- –ì–æ–ª–æ—Å–æ–≤–æ–µ 60 —Å–µ–∫ ‚Üí —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è ~20-30 —Å–µ–∫

**–ï—Å–ª–∏ –≤–∫–ª—é—á–∏—Ç—å GPU (Tesla V100):**
- –ì–æ–ª–æ—Å–æ–≤–æ–µ 30 —Å–µ–∫ ‚Üí —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è ~2-5 —Å–µ–∫
- 4-10x —É—Å–∫–æ—Ä–µ–Ω–∏–µ

---

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å

### –ë–µ—Å–ø–ª–∞—Ç–Ω–æ! üéâ

- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö API –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ü–æ–ª–Ω–∞—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ—Ñ–ª–∞–π–Ω (–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏)

---

## üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏

–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å –≤ `whisper-service.py`:

### tiny (75 MB)
```python
model = WhisperModel('tiny', device='cpu', compute_type='int8')
```
- –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ (~5 —Å–µ–∫)
- –ö–∞—á–µ—Å—Ç–≤–æ ~70%

### small (466 MB)
```python
model = WhisperModel('small', device='cpu', compute_type='int8')
```
- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (~30-60 —Å–µ–∫)
- –ö–∞—á–µ—Å—Ç–≤–æ ~85%

### medium (1.5 GB)
```python
model = WhisperModel('medium', device='cpu', compute_type='int8')
```
- –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ (~60-120 —Å–µ–∫)
- –ö–∞—á–µ—Å—Ç–≤–æ ~90%

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** `base` - –ª—É—á—à–∏–π –±–∞–ª–∞–Ω—Å!

---

## üêõ Troubleshooting

### –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
cat ~/whisper.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–ø—É—â–µ–Ω –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å
ps aux | grep whisper-service
```

### –ü–æ—Ä—Ç –∑–∞–Ω—è—Ç

```bash
# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 5000
sudo lsof -i :5000

# –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
kill -9 <PID>
```

### –ú–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
df -h

# –ú–æ–¥–µ–ª—å —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
# –ü—É—Ç—å: ~/.cache/huggingface/hub/
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
tail -f ~/whisper.log
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏

```bash
watch -n 1 'ps aux | grep whisper-service'
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–°–µ—Ä–≤–µ—Ä:** 195.209.210.250  
**–ü–æ—Ä—Ç:** 5000  
**–ú–æ–¥–µ–ª—å:** whisper-base  
**Device:** CPU (int8)  
**URL:** http://195.209.210.250:5000  

**Endpoints:**
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
- `POST /transcribe` - —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∞—É–¥–∏–æ

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è** —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö  
‚úÖ **–•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ** –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ (~80%)  
‚úÖ **–ü—Ä–∏–µ–º–ª–µ–º–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å** –Ω–∞ CPU (10-30 —Å–µ–∫)  
‚úÖ **–ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —á–µ—Ä–µ–∑ REST API  
‚úÖ **–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å** - –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–∫–∏–¥–∞—é—Ç —Ç–≤–æ–π —Å–µ—Ä–≤–µ—Ä  

---

*–ù–∞—Å—Ç—Ä–æ–µ–Ω–æ: 2025-11-13*  
*–í–µ—Ä—Å–∏—è: faster-whisper 1.2.1*

